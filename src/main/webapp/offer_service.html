<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <title>REGISTER</title>
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" href="css/register.css">
    <!--导入jquery-->
    <script src="js/jquery-3.3.1.js"></script>
    <script>
        $(function () {
            $.get("user/findOne",{},function (data) {
                var login_div = document.getElementById("login");
                var logout_div = document.getElementById("login_out");

                document.getElementById("uid").value =data.uid;

                if(data.uid != -1) {
                    var msg = "Welcome Back, " + data.firstname + " " + data.lastname;
                    $("#span_username").html(msg);
                    logout_div .style.display = "none";
                    login_div.style.display = "block";
                }

                else{
                    logout_div .style.display = "block";
                    login_div.style.display = "none";
                }

            });

            $.get("category/findAll",{},function(data){
                // data=[{cid:1,cname:'国内游'},{},{}]
                var lis = '';
                // 遍历数组，拼接字符串
                for (var i = 0; i < data.length;i++){
                    //
                    var li = '<input type="radio" id = "category" name="category" value=' + data[i].cid + ' />' +
                        data[i].cname + '<br/>'
                }
                $("#service_category").html(lis);
            });

            function checkPrice() {

                var reg = /(^[-+]?[1-9]\d*(\.\d{1,2})?$)|(^[-+]?[0]{1}(\.\d{1,2})?$)/;
                if ($("#price").val() == "") {
                    return false;
                } else {
                    if (!reg.test($("#price").val())) {
                        return false;
                    } else {
                        return true;
                    }
                }
            }

            $(function(){
                // 当表单提交时，调用所有的校验方法
                $("#serviceForm").submit(function(){
                    // 1.发送数据到服务器
                    if(checkPrice()){
                        // 校验通过，发送Ajax请求，提交表单的数据

                        $.post("offer/offer",$("#serviceForm").serialize(),function(data){
                            // 处理服务器响应的数据  data   {flag:true,errorMsg:"注册失败"}
                            if(data.flag){
                                // 注册成功，跳转成功页面
                                location.href = "offer_ok.html";
                            }else{
                                // 注册失败,给errorMsg添加提示信息
                                $("#errorMsg").html(data.errorMsg);
                            }
                        });
                    }
                    // 2.不让页面跳转
                    return false;
                    // 如果匿名的function方法没有返回值或者返回位true，则表单提交，如果返回位false，则表单不提交
                });
            });
        });


    </script>
</head>
<body>
<!--引入头部-->
<div id="header"></div>
<!-- 头部 end -->
<div class="rg_layout">
    <div class="rg_form clearfix">
        <div class="rg_form_left">
            <p>CREATE YOUR SERVICE OFFERING</p>
        </div>
        <div class="rg_form_center">
            <div id="errorMsg" style="color: red;text-align: center"></div>
            <!--注册表单-->
            <form id="serviceForm" action="offer">
                <!--提交处理请求的标识符-->
                <input type="hidden" name="action" value="offer">
                <table style="margin-top: 25px;">
                    <tr>
                        <td class="td_left">
                            <label for="stitle">Service name</label>
                        </td>
                        <td class="td_right">
                            <input type="text" id="stitle" name="stitle" placeholder="Enter your service name">
                        </td>
                    </tr>
                    <br>
                    <tr>
                        <td class="td_left">
                            <label for="cid">Service Category</label>
                        </td>
                        <td class="td_right">
                            <input type="radio" id="cid" name="cid" value=1 checked> Math<br>
                            <input type="radio" name="cid" value=2> Science<br>
                            <input type="radio" name="cid" value=3> English<br>
                            <input type="radio" name="cid" value=4> Foreign Language<br>
                            <input type="radio" name="cid" value=5> Business<br>
                        </td>
                    </tr>
                    <br>
                    <tr>
                        <td class="td_left">
                            <label for="price">Service Price / Hour`




                            </label>
                        </td>
                        <td class="td_right">
                            <input type="text" id="price" name="price" placeholder="Enter the price for the service">
                        </td>
                    </tr>
                    <br>

                    <label for="uid"></label>
                    <input type="hidden" name="uid" value= 0 id="uid" />

                    <tr>
                        <td class="td_left">
                            <label for="place">Service Place</label>
                        </td>
                        <td class="td_right">
                            <input type="text" id="place" name="place" placeholder="Enter the place for the service">
                        </td>
                    </tr>

                    <tr>
                        <td class="td_left">
                            <label for="sbody">Service Description</label>
                        </td>
                        <td class="td_right">
                            <input type="text" id="sbody" name="sbody" placeholder="Enter the description for the service">
                        </td>
                    </tr>

                    <br>
                    <tr>
                        <td class="td_left">
                        </td>
                        <td class="td_right check">
                            <input type="submit" class="submit" value="offer">
                            <span id="msg" style="color: red;"></span>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
</div>
<!--引入尾部-->
<div id="footer"></div>
<!--导入布局js，共享header和footer-->
<script type="text/javascript" src="js/include.js"></script>

</body>
</html>